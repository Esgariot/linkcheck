language: rust
cache: cargo
os: linux

rust:
  // see https://github.com/rust-lang/rust/issues/67423
  - 1.38.0
  - stable
  - nightly

script:
  - cargo build --verbose
  - cargo test --verbose
  - cargo doc --verbose

before_deploy:
  - cargo doc --verbose
  - echo '<meta http-equiv="refresh" content="0; url=linkcheck/index.html" /> ' > target/doc/index.html
  - cp -r target/doc public

deploy:
  - provider: pages
    edge: true
    token: "$GITHUB_TOKEN"
    local_dir: public
    on:
      branch: master
      rust: nightly
